<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>掷骰子</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="main">
        <!-- 加载资源动画 -->
        <div class="open-load animate__animated">
            <div class="banner"></div>
            <div class="progress-box">
                <div class="progress">
                    <div class="value"></div>
                </div>
                <!-- 加载数量提示 -->
                <div class="load-down-num">加载中...</div>
            </div>
        </div>

        <!-- 头部用户信息 -->
        <div class="top-info">
            <!-- left -->
            <div class="left">
                <div class="user left-item">
                    <img src="./static/imgs/logo.jpg" class="logo">
                    <div class="user-info">
                        <div class="name left-item text-cut">我爱吃辣条啊</div>
                        <div class="integral left-item text-cut">积分：80</div>
                    </div>
                </div>
            </div>
            <!-- right -->
            <div class="right">
                <div class="right-item">当前关卡：XXX关卡</div>
                <div class="right-item">下一关：XXX关卡</div>
            </div>
        </div>
        <!-- 附加显示 -->
        <ol class="attach-view">
            <li class="rule attach-item">规则</li>
            <li class="dice attach-item">骰子</li>
        </ol>
        
        <!-- 底部控件 -->
        <ol class="zoom-control">
            <li class="zoom-up">+</li>
            <li class="zoom-down">-</li>
        </ol>

        <!-- 当前楼层 -->
        <div class="floot-box">
            <div class="floot-show">B1</div>
            <ol class="floot-content">
                <li class="floot-item">B1</li>
                <li class="floot-item">B2</li>
            </ol>
        </div>

        <!-- 规则 -->
        <div class="prop animate__animated">
            <div class="prop-box">
                <div class="hd">弹窗标题</div>
                <div class="content">
                    打瞌睡的金卡角度看拉家带口洒家打开拉萨
                </div>
                <span class="close">×</span>
            </div>
        </div>

        <!-- 弹窗 -->
        <div class="dialog animate__animated">
            <!-- 积分 -->
            <div class="dialog-box integral">
                <div class="content">
                    <div class="body">
                        <img class="gold" src="./static/imgs/gold.png">
                        <div class="title"><span class="text">任务达成</span> +<span class="value">20</span> 积分</div>
                        <div class="spec">积分可用于夺宝大赛</div>
                    </div>
                </div>
                <div class="footer">
                    <span class="detail">积分可在我的积分中查看</span>
                    <div class="btn submit">知道了</div>
                </div>
            </div> 
            <!-- 确认提示 -->
            <div class="dialog-box confirm">
                <div class="hd">系统提示</div>
                <span class="close">×</span>
                <div class="content">
                    的骄傲还是觉得哈设计开发哈接口返回空间
                </div>
                <div class="footer">
                    <div class="btn cc">取消</div>
                    <div class="btn cf">确认</div>
                </div>
            </div>
            <!-- 提示 -->
            <div class="dialog-box alert">
                <div class="hd">系统提示</div>
                <span class="close">×</span>
                <div class="content">
                    的骄傲还是觉得哈设计开发哈接口返回空间
                </div>
                <div class="footer">
                    <div class="btn cc">确认</div>
                </div>
            </div>
            
        </div>

        <!-- 地图内容 -->
        <div class="map-box">
            <canvas class="map" id="map-B2"></canvas>
            <canvas class="map" id="map-B1"></canvas>
        </div>

        <!-- 骰子内容 -->
        <div class="dice-box animate__animated">
            <canvas id="RollDice" class="zdog-rolldice"></canvas>
            <div class="dice-btn">投一次</div>
        </div>


        <!-- 音效 -->
        <audio loop="loop"  defaultPlaybackRate="2"  src="./static/rollDice_bgm.mp3" class="rollDice_bgm" id="rollDice_bgm"/>
        <audio src="./static/click.mp3" class="click_bgm" id="click_bgm"/>
    </div>
    <script src="https://unpkg.com/zdog@1/dist/zdog.dist.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
    <script src="./static/js/wx_sdk.js"></script>
    <script src="./game.js"></script>
    <script src="./map.js"></script>
    <script src="./rollDice.js"></script>
    <script src="./main.js"></script>
    <script>
        var Game = new Game();
        // Game.dialog({
        //     "type":"integral",
        //     "data":{
        //         integral:20,
        //         detail:'积分可用于夺宝大赛'
        //     }
        // })
        // Game.dialog({
        //     "type":"confirm",
        //     "title":"通关提示",
        //     "detail":"什么一些乱七八糟得东西提示"
        // })
        // Game.dialog({
        //     "type":"alert",
        //     "title":"通关提示",
        //     "detail":"什么一些乱七八糟得东西提示"
        // })
        // console.log(jWeixin)
        // console.log(location)
        // 游戏初始化完成 执行之后得交互
        Game.init(function(){
            console.log("游戏加载完成")
            Game.dialog({
                "type":"confirm",
                "title":"通关提示",
                "detail":"什么一些乱七八糟得东西提示"
            });
            if(location.search){
                let params = location.search.split('?')[1];
                var s = resetParam(params);
                if(s.token){
                    localStorage.setItem('token',s.token);
                }else{
                    // 未登录  去登陆
                    jWeixin.miniProgram.reLaunch({url: "/pages/index?current=user&link="+ encodeURIComponent(location.href)});
                }
            }

            var curLevel = JSON.parse(localStorage.getItem('currentLevel'));
            if(curLevel){
                console.log(Game)
                Game.map.location(curLevel)
            }
        })

        // 生成search对象
        function resetParam(params){
            var ps = params.split('&'),result = {};
            for(let p of ps){
                result[p.split('=')[0]] = p.split('=')[1];
            }
            return result;
        }
    </script>
</body>
</html>